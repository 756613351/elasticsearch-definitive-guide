<!DOCTYPE HTML>
<html lang="en-US" manifest="../manifest.appcache">
    
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        
        <meta charset="UTF-8">
        <title>Bulk | Elasticsearch 权威指南</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="">
        <meta name="description" content="译者现在的工作项目中需要用到elasticsearch，但是在网络中找了很多的相关的内容都很不完善，中文的文档更是寥寥无几，所以我决定边研究边翻译一下官方推出的权威手册。在这里要先感谢原作者们！如果各位在这里发现了错误之处，请大家在Issue中提出或者pr这个项目。">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="../data/conclusion.html" />
        
        
        <link rel="prev" href="../data/mget.html" />
        

        <meta property="og:title" content="Bulk | Elasticsearch 权威指南">
        <meta property="og:site_name" content="Elasticsearch 权威指南">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="..\gitbook/images/favicon.ico" type="image/x-icon">
        
        
    </head>
    <body>
        
        

        <link rel="stylesheet" href="..\gitbook/style.css">
        


        
    <div class="book"  data-level="3.11" data-basepath=".." data-revision="1402135601274">
    <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    
    <a href="https://github.com/null" target="_blank" class="btn pull-left home-bookmark" aria-label="GitHub home"><i class="fa fa-bookmark-o"></i></a>
    
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    <span id="font-settings-wrapper">
        <a href="#" class="btn pull-left toggle-font-settings" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="btn-group btn-block">
        <button id="reduce-font-size" class="btn btn-default">A</button>
        <button id="enlarge-font-size" class="btn btn-default">A</button>
    </div>

    <ul class="list-group font-family-list">
        <li class="list-group-item" data-font="0">Serif</li>
        <li class="list-group-item" data-font="1">Sans</li>
    </ul>

    <div class="btn-group btn-group-xs btn-block color-theme-list">
        <button type="button" class="btn btn-default" id="color-theme-preview-0" data-theme="0">White</button>
        <button type="button" class="btn btn-default" id="color-theme-preview-1" data-theme="1">Sepia</button>
        <button type="button" class="btn btn-default" id="color-theme-preview-2" data-theme="2">Night</button>
    </div>
</div>

    </span>

    <!-- Actions Right -->
    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    

    

    <!-- Title -->
    <h1>
        <i class="fa fa-spinner fa-spin"></i>
        <a href="../" >Elasticsearch 权威指南</a>
    </h1>
</div>

    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        

        

        

        

        <li data-level="0" data-path="index.html">
            <a href="../"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
    
        <li class="chapter " data-level="1" data-path="getting_started/README.html">
            
            <a href="../getting_started/README.html">
                <i class="fa fa-check"></i> <b>1.</b> 入门
            </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="getting_started/what_is_it.html">
            
            <a href="../getting_started/what_is_it.html">
                <i class="fa fa-check"></i> <b>1.1.</b> 初识
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="getting_started/installing_es.html">
            
            <a href="../getting_started/installing_es.html">
                <i class="fa fa-check"></i> <b>1.2.</b> 安装
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="getting_started/api.html">
            
            <a href="../getting_started/api.html">
                <i class="fa fa-check"></i> <b>1.3.</b> API
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="getting_started/document.html">
            
            <a href="../getting_started/document.html">
                <i class="fa fa-check"></i> <b>1.4.</b> 文档
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="getting_started/tutorial_indexing.html">
            
            <a href="../getting_started/tutorial_indexing.html">
                <i class="fa fa-check"></i> <b>1.5.</b> 索引
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="getting_started/tutorial_search.html">
            
            <a href="../getting_started/tutorial_search.html">
                <i class="fa fa-check"></i> <b>1.6.</b> 搜索
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="getting_started/tutorial_aggregations.html">
            
            <a href="../getting_started/tutorial_aggregations.html">
                <i class="fa fa-check"></i> <b>1.7.</b> 汇总
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="getting_started/tutorial_conclusion.html">
            
            <a href="../getting_started/tutorial_conclusion.html">
                <i class="fa fa-check"></i> <b>1.8.</b> 小结
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="getting_started/distributed.html">
            
            <a href="../getting_started/distributed.html">
                <i class="fa fa-check"></i> <b>1.9.</b> 分布式
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="getting_started/conclusion.html">
            
            <a href="../getting_started/conclusion.html">
                <i class="fa fa-check"></i> <b>1.10.</b> 本章总结
            </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="distributed_cluster/README.html">
            
            <a href="../distributed_cluster/README.html">
                <i class="fa fa-check"></i> <b>2.</b> 分布式集群
            </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="distributed_cluster/empty_cluster.html">
            
            <a href="../distributed_cluster/empty_cluster.html">
                <i class="fa fa-check"></i> <b>2.1.</b> 空集群
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="distributed_cluster/cluster_health.html">
            
            <a href="../distributed_cluster/cluster_health.html">
                <i class="fa fa-check"></i> <b>2.2.</b> 集群健康
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="distributed_cluster/add_an_index.html">
            
            <a href="../distributed_cluster/add_an_index.html">
                <i class="fa fa-check"></i> <b>2.3.</b> 添加索引
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="distributed_cluster/add_failover.html">
            
            <a href="../distributed_cluster/add_failover.html">
                <i class="fa fa-check"></i> <b>2.4.</b> 容错移转
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="distributed_cluster/scale_horizontally.html">
            
            <a href="../distributed_cluster/scale_horizontally.html">
                <i class="fa fa-check"></i> <b>2.5.</b> 横向扩展
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="distributed_cluster/scale_more.html">
            
            <a href="../distributed_cluster/scale_more.html">
                <i class="fa fa-check"></i> <b>2.6.</b> 扩展
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="distributed_cluster/coping_with_failure.html">
            
            <a href="../distributed_cluster/coping_with_failure.html">
                <i class="fa fa-check"></i> <b>2.7.</b> 错误恢复
            </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="data/README.html">
            
            <a href="../data/README.html">
                <i class="fa fa-check"></i> <b>3.</b> 数据
            </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="data/document.html">
            
            <a href="../data/document.html">
                <i class="fa fa-check"></i> <b>3.1.</b> 文档
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="data/index.html">
            
            <a href="../data/index.html">
                <i class="fa fa-check"></i> <b>3.2.</b> 索引
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="data/get.html">
            
            <a href="../data/get.html">
                <i class="fa fa-check"></i> <b>3.3.</b> Get
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="data/exists.html">
            
            <a href="../data/exists.html">
                <i class="fa fa-check"></i> <b>3.4.</b> 存在
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="data/update.html">
            
            <a href="../data/update.html">
                <i class="fa fa-check"></i> <b>3.5.</b> 更新
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="data/create.html">
            
            <a href="../data/create.html">
                <i class="fa fa-check"></i> <b>3.6.</b> 创建
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="data/delete.html">
            
            <a href="../data/delete.html">
                <i class="fa fa-check"></i> <b>3.7.</b> 删除
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="data/version_control.html">
            
            <a href="../data/version_control.html">
                <i class="fa fa-check"></i> <b>3.8.</b> 版本控制
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.9" data-path="data/partial_update.html">
            
            <a href="../data/partial_update.html">
                <i class="fa fa-check"></i> <b>3.9.</b> 局部更新
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.10" data-path="data/mget.html">
            
            <a href="../data/mget.html">
                <i class="fa fa-check"></i> <b>3.10.</b> Mget
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.11" data-path="data/bulk.html">
            
            <a href="../data/bulk.html">
                <i class="fa fa-check"></i> <b>3.11.</b> Bulk
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.12" data-path="data/conclusion.html">
            
            <a href="../data/conclusion.html">
                <i class="fa fa-check"></i> <b>3.12.</b> 总结
            </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Generated using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 71.875%;min-width: 68.75%;"></div>
    </div>
    <div class="chapters">
    
        <a href="../index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="../getting_started/README.html" title="入门" class="chapter done new-chapter" data-progress="1" style="left: 3.125%;"></a>
    
        <a href="../getting_started/what_is_it.html" title="初识" class="chapter done " data-progress="1.1" style="left: 6.25%;"></a>
    
        <a href="../getting_started/conclusion.html" title="本章总结" class="chapter done " data-progress="1.10" style="left: 9.375%;"></a>
    
        <a href="../getting_started/installing_es.html" title="安装" class="chapter done " data-progress="1.2" style="left: 12.5%;"></a>
    
        <a href="../getting_started/api.html" title="API" class="chapter done " data-progress="1.3" style="left: 15.625%;"></a>
    
        <a href="../getting_started/document.html" title="文档" class="chapter done " data-progress="1.4" style="left: 18.75%;"></a>
    
        <a href="../getting_started/tutorial_indexing.html" title="索引" class="chapter done " data-progress="1.5" style="left: 21.875%;"></a>
    
        <a href="../getting_started/tutorial_search.html" title="搜索" class="chapter done " data-progress="1.6" style="left: 25%;"></a>
    
        <a href="../getting_started/tutorial_aggregations.html" title="汇总" class="chapter done " data-progress="1.7" style="left: 28.125%;"></a>
    
        <a href="../getting_started/tutorial_conclusion.html" title="小结" class="chapter done " data-progress="1.8" style="left: 31.25%;"></a>
    
        <a href="../getting_started/distributed.html" title="分布式" class="chapter done " data-progress="1.9" style="left: 34.375%;"></a>
    
        <a href="../distributed_cluster/README.html" title="分布式集群" class="chapter done new-chapter" data-progress="2" style="left: 37.5%;"></a>
    
        <a href="../distributed_cluster/empty_cluster.html" title="空集群" class="chapter done " data-progress="2.1" style="left: 40.625%;"></a>
    
        <a href="../distributed_cluster/cluster_health.html" title="集群健康" class="chapter done " data-progress="2.2" style="left: 43.75%;"></a>
    
        <a href="../distributed_cluster/add_an_index.html" title="添加索引" class="chapter done " data-progress="2.3" style="left: 46.875%;"></a>
    
        <a href="../distributed_cluster/add_failover.html" title="容错移转" class="chapter done " data-progress="2.4" style="left: 50%;"></a>
    
        <a href="../distributed_cluster/scale_horizontally.html" title="横向扩展" class="chapter done " data-progress="2.5" style="left: 53.125%;"></a>
    
        <a href="../distributed_cluster/scale_more.html" title="扩展" class="chapter done " data-progress="2.6" style="left: 56.25%;"></a>
    
        <a href="../distributed_cluster/coping_with_failure.html" title="错误恢复" class="chapter done " data-progress="2.7" style="left: 59.375%;"></a>
    
        <a href="../data/README.html" title="数据" class="chapter done new-chapter" data-progress="3" style="left: 62.5%;"></a>
    
        <a href="../data/document.html" title="文档" class="chapter done " data-progress="3.1" style="left: 65.625%;"></a>
    
        <a href="../data/mget.html" title="Mget" class="chapter done " data-progress="3.10" style="left: 68.75%;"></a>
    
        <a href="../data/bulk.html" title="Bulk" class="chapter done " data-progress="3.11" style="left: 71.875%;"></a>
    
        <a href="../data/conclusion.html" title="总结" class="chapter  " data-progress="3.12" style="left: 75%;"></a>
    
        <a href="../data/index.html" title="索引" class="chapter  " data-progress="3.2" style="left: 78.125%;"></a>
    
        <a href="../data/get.html" title="Get" class="chapter  " data-progress="3.3" style="left: 81.25%;"></a>
    
        <a href="../data/exists.html" title="存在" class="chapter  " data-progress="3.4" style="left: 84.375%;"></a>
    
        <a href="../data/update.html" title="更新" class="chapter  " data-progress="3.5" style="left: 87.5%;"></a>
    
        <a href="../data/create.html" title="创建" class="chapter  " data-progress="3.6" style="left: 90.625%;"></a>
    
        <a href="../data/delete.html" title="删除" class="chapter  " data-progress="3.7" style="left: 93.75%;"></a>
    
        <a href="../data/version_control.html" title="版本控制" class="chapter  " data-progress="3.8" style="left: 96.875%;"></a>
    
        <a href="../data/partial_update.html" title="局部更新" class="chapter  " data-progress="3.9" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_8188">
                    
                        <h1 id="bulk-">bulk更方便</h1>
<p>In the same way that <code>mget</code> allows us to retrieve multiple documents at once,
the <code>bulk</code> API allows us to make multiple <code>create</code>, <code>index</code>, <code>update</code> or
<code>delete</code>  requests in a single step. This is particularly useful if you need
to index a data stream such as log events, which can be queued up and indexed
in batches of hundreds or thousands.</p>
<p>The <code>bulk</code> request body has the following, slightly unusual, format:</p>
<pre><code class="lang-js">{ action: { metadata }}\n
{ request body        }\n
{ action: { metadata }}\n
{ request body        }\n
...
</code></pre>
<p>This format is like a <em>stream</em> of valid one-line JSON documents joined
together by newline <code>&quot;\n&quot;</code> characters. Two important points to note:</p>
<ul>
<li><p>Every line must end with a newline character <code>&quot;\n&quot;</code>, <em>including the last
line</em>. These are used as markers to allow for efficient line separation.</p>
</li>
<li><p>The lines cannot contain unescaped newline characters, as they would
interfere with parsing -- that means that the JSON must <em>not</em> be
pretty-printed.</p>
</li>
</ul>
<p>TIP: In &lt;<bulk-format>&gt; we explain why the <code>bulk</code> API uses this format.</p>
<p>The <em>action/metadata</em> line specifies <em>what action</em> to do to <em>which document</em>.</p>
<p>The <em>action</em> must be one of <code>index</code>, <code>create</code>, <code>update</code> or <code>delete</code>. The
<em>metadata</em> should specify the <code>_index</code>, <code>_type</code> and <code>_id</code> of the document to
be indexed, created, updated or deleted.</p>
<p>For instance, a <code>delete</code> request could look like this:</p>
<pre><code class="lang-js">{ <span class="hljs-string">"delete"</span>: { <span class="hljs-string">"_index"</span>: <span class="hljs-string">"website"</span>, <span class="hljs-string">"_type"</span>: <span class="hljs-string">"blog"</span>, <span class="hljs-string">"_id"</span>: <span class="hljs-string">"123"</span> }}
</code></pre>
<p>The <em>request body</em> line consists of the document <code>_source</code> itself -- the fields
and values that the document contains.  It is required for <code>index</code> and
<code>create</code> operations, which makes sense: you must supply the document to index.</p>
<p>It is also required for <code>update</code> operations and should consist of the same
request body that you would pass to the <code>update</code> API: <code>doc</code>, <code>upsert</code>,
<code>script</code> etc. No <em>request body</em> line is required for a delete.</p>
<pre><code class="lang-js">{ <span class="hljs-string">"create"</span>:  { <span class="hljs-string">"_index"</span>: <span class="hljs-string">"website"</span>, <span class="hljs-string">"_type"</span>: <span class="hljs-string">"blog"</span>, <span class="hljs-string">"_id"</span>: <span class="hljs-string">"123"</span> }}
{ <span class="hljs-string">"title"</span>:    <span class="hljs-string">"My first blog post"</span> }
</code></pre>
<p>If no <code>_id</code> is specified, then an ID will be auto-generated:</p>
<pre><code class="lang-js">{ <span class="hljs-string">"index"</span>: { <span class="hljs-string">"_index"</span>: <span class="hljs-string">"website"</span>, <span class="hljs-string">"_type"</span>: <span class="hljs-string">"blog"</span> }}
{ <span class="hljs-string">"title"</span>:    <span class="hljs-string">"My second blog post"</span> }
</code></pre>
<p>To put it all together, a complete <code>bulk</code> request has this form:</p>
<pre><code class="lang-js">POST /_bulk
{ <span class="hljs-string">"delete"</span>: { <span class="hljs-string">"_index"</span>: <span class="hljs-string">"website"</span>, <span class="hljs-string">"_type"</span>: <span class="hljs-string">"blog"</span>, <span class="hljs-string">"_id"</span>: <span class="hljs-string">"123"</span> }} &lt;<span class="hljs-number">1</span>&gt;
{ <span class="hljs-string">"create"</span>: { <span class="hljs-string">"_index"</span>: <span class="hljs-string">"website"</span>, <span class="hljs-string">"_type"</span>: <span class="hljs-string">"blog"</span>, <span class="hljs-string">"_id"</span>: <span class="hljs-string">"123"</span> }}
{ <span class="hljs-string">"title"</span>:    <span class="hljs-string">"My first blog post"</span> }
{ <span class="hljs-string">"index"</span>:  { <span class="hljs-string">"_index"</span>: <span class="hljs-string">"website"</span>, <span class="hljs-string">"_type"</span>: <span class="hljs-string">"blog"</span> }}
{ <span class="hljs-string">"title"</span>:    <span class="hljs-string">"My second blog post"</span> }
{ <span class="hljs-string">"update"</span>: { <span class="hljs-string">"_index"</span>: <span class="hljs-string">"website"</span>, <span class="hljs-string">"_type"</span>: <span class="hljs-string">"blog"</span>, <span class="hljs-string">"_id"</span>: <span class="hljs-string">"123"</span>, <span class="hljs-string">"_retry_on_conflict"</span> : <span class="hljs-number">3</span>} }
{ <span class="hljs-string">"doc"</span> : {<span class="hljs-string">"title"</span> : <span class="hljs-string">"My updated blog post"</span>} } &lt;<span class="hljs-number">2</span>&gt;
</code></pre>
<ol>
<li>Notice how the <code>delete</code> <em>action</em> does not have a <em>request body</em>, it is
 followed immediately by another <em>action</em>.</li>
<li>Remember the final newline character.</li>
</ol>
<p>The Elasticsearch response contains the <code>items</code> array which lists the result of
each request, in the same order as we requested them:</p>
<pre><code class="lang-js">{
   <span class="hljs-string">"took"</span>: <span class="hljs-number">4</span>,
   <span class="hljs-string">"errors"</span>: <span class="hljs-literal">false</span>, <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">1</span>&gt;</span>
   "items": [
      {  "delete": {
            "_index":   "website",
            "_type":    "blog",
            "_id":      "123",
            "_version": 2,
            "status":   200,
            "found":    true
      }},
      {  "create": {
            "_index":   "website",
            "_type":    "blog",
            "_id":      "123",
            "_version": 3,
            "status":   201
      }},
      {  "create": {
            "_index":   "website",
            "_type":    "blog",
            "_id":      "EiwfApScQiiy7TIKFxRCTw",
            "_version": 1,
            "status":   201
      }},
      {  "update": {
            "_index":   "website",
            "_type":    "blog",
            "_id":      "123",
            "_version": 4,
            "status":   200
      }}
   ]
}}</span>
</code></pre>
<ol>
<li>All sub-requests completed successfully.</li>
</ol>
<p>Each sub-request is executed independently, so the failure of one sub-request
won&#39;t affect the success of the others. If any of the requests fail, then the
top-level  <code>error</code> flag is set to <code>true</code> and the error details will be
reported under the relevant request:</p>
<pre><code class="lang-js">POST /_bulk
{ <span class="hljs-string">"create"</span>: { <span class="hljs-string">"_index"</span>: <span class="hljs-string">"website"</span>, <span class="hljs-string">"_type"</span>: <span class="hljs-string">"blog"</span>, <span class="hljs-string">"_id"</span>: <span class="hljs-string">"123"</span> }}
{ <span class="hljs-string">"title"</span>:    <span class="hljs-string">"Cannot create - it already exists"</span> }
{ <span class="hljs-string">"index"</span>:  { <span class="hljs-string">"_index"</span>: <span class="hljs-string">"website"</span>, <span class="hljs-string">"_type"</span>: <span class="hljs-string">"blog"</span>, <span class="hljs-string">"_id"</span>: <span class="hljs-string">"123"</span> }}
{ <span class="hljs-string">"title"</span>:    <span class="hljs-string">"But we can update it"</span> }
</code></pre>
<p>In the response we can see that it failed to <code>create</code> document <code>123</code> because
it already exists, but the subsequent <code>index</code> request, also on document <code>123</code>,
succeeded:</p>
<pre><code class="lang-js">{
   <span class="hljs-string">"took"</span>: <span class="hljs-number">3</span>,
   <span class="hljs-string">"errors"</span>: <span class="hljs-literal">true</span>, <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">1</span>&gt;</span>
   "items": [
      {  "create": {
            "_index":   "website",
            "_type":    "blog",
            "_id":      "123",
            "status":   409, <span class="hljs-tag">&lt;<span class="hljs-title">2</span>&gt;</span>
            "error":    "DocumentAlreadyExistsException <span class="hljs-tag">&lt;<span class="hljs-title">3</span>&gt;</span>
                        [[website][4] [blog][123]:
                        document already exists]"
      }},
      {  "index": {
            "_index":   "website",
            "_type":    "blog",
            "_id":      "123",
            "_version": 5,
            "status":   200 <span class="hljs-tag">&lt;<span class="hljs-title">4</span>&gt;</span>
      }}
   ]
}</span>
</code></pre>
<ol>
<li>One or more requests has failed.</li>
<li>The HTTP status code for this request reports <code>409 CONFLICT</code>.</li>
<li>The error message explaining why the request failed.</li>
<li>The second request succeeded with an HTTP status code of <code>200 OK</code>.</li>
</ol>
<p>That also means that <code>bulk</code> requests are not atomic -- they cannot be used to
implement transactions.  Each request is processed separately, so the success
or failure of one request will not interfere with the others.</p>
<h3 id="don-t-repeat-yourself">Don&#39;t repeat yourself</h3>
<p>Perhaps you are batch indexing logging data into the same <code>index</code>, and with the
same <code>type</code>. Having to specify the same metadata for every document is a waste.
Instead, just as for the <code>mget</code> API, the <code>bulk</code> request accepts a default <code>/_index</code> or
<code>/_index/_type</code> in the URL:</p>
<pre><code class="lang-js">POST /website/_bulk
{ <span class="hljs-string">"index"</span>: { <span class="hljs-string">"_type"</span>: <span class="hljs-string">"log"</span> }}
{ <span class="hljs-string">"event"</span>: <span class="hljs-string">"User logged in"</span> }
</code></pre>
<p>You can still override the <code>_index</code> and <code>_type</code> in the metadata line, but it
will use the values in the URL as defaults:</p>
<pre><code class="lang-js">POST /website/log/_bulk
{ <span class="hljs-string">"index"</span>: {}}
{ <span class="hljs-string">"event"</span>: <span class="hljs-string">"User logged in"</span> }
{ <span class="hljs-string">"index"</span>: { <span class="hljs-string">"_type"</span>: <span class="hljs-string">"blog"</span> }}
{ <span class="hljs-string">"title"</span>: <span class="hljs-string">"Overriding the default type"</span> }
</code></pre>
<h3 id="how-big-is-too-big-">How big is too big?</h3>
<p>The entire bulk request needs to be loaded into memory by the node which
receives our request, so the bigger the request, the less memory available for
other requests. There is an optimal size of <code>bulk</code> request. Above that size,
performance no longer improves and may even drop off.</p>
<p>The optimal size, however, is not a fixed number. It depends entirely on your
hardware, your document size and complexity, and your indexing and search
load.  Fortunately, it is easy to find this <em>sweetspot</em>:</p>
<p>Try indexing typical documents in batches of increasing size. When performance
starts to drop off, your batch size is too big. A good place to start is with
batches of between 1,000 and 5,000 documents or, if your documents are very
large, with even smaller batches.</p>
<p>It is often useful to keep an eye on the physical size of your bulk requests.
One thousand 1kB documents is very different than one thousand 1MB documents.
A good bulk size to start playing with is around 5-15MB in size.</p>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="../data/mget.html" class="navigation navigation-prev " aria-label="Previous page: Mget"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../data/conclusion.html" class="navigation navigation-next " aria-label="Next page: 总结"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        

        <script src="http://cdn.bootcss.com/ace/1.1.3/ace.js"></script>
        <script src="http://cdn.bootcss.com/ace/1.1.3/mode-javascript.js"></script>
        <script src="..\gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="..\gitbook/app.js"></script>
        

    
    <script src="..\gitbook/plugins/gitbook-plugin-mixpanel/plugin.js"></script>
    

    
    <script src="http://cdn.mathjax.org/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="..\gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
